<%- include("partials/header.ejs") %>
    <%- include("partials/navbar.ejs") %>
        <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel" style="height: 500px">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"
                    aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"
                    aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"
                    aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="img/Design2.png" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="img/clinica2.png" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item">
                    <img src="img/clinica.png" class="d-block w-100" alt="...">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
                data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
                data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>

        <br><br><br>
        <h1 class="titulo-c feature">CL√çNICA PSICOL√ìGICA KACIELY</h1>
        <div class="container-cards">
            <div class="cards">
                <div class="card feature">
                    <div class="card1">
                        <div class="icon">üìÖ</div>
                        <h2>Agenda e hor√°rios de atendimento</h2>
                        <div class="texto-card1""><strong>Segunda √† sexta das 09:00 at√© √†s 17:00</strong></div>
                </div>
            </div>
                <div class=" card feature">
                            <div class="card2">
                                <div class="icon">üìç</div>
                                <h2>Localiza√ß√£o</h2>
                                <div class="texto-card2""><strong>üìç Rua Martinho Brunelli, Bairro Mina uni√£o</strong></div>
                </div>
            </div>
                <div class=" card feature">
                                    <div class="card3">
                                        <div class="icon">üìñ</div>
                                        <h2>Especializa√ß√£o</h2>
                                        <div class="texto-card3""><strong>Especialista em Sa√∫de Mental</strong></div>
                </div>
            </div>
                <div class=" card feature">
                                            <div class="card4">
                                                <div class="icon">‚úîÔ∏è</div>
                                                <h2>Confiabilidade</h2>
                                                <div class="texto-card4"><strong>Na nossa cl√≠nica psiqui√°trica, a
                                                        confian√ßa √© a base do nosso trabalho. Garantimos um atendimento
                                                        profissional e acolhedor, e garantimos que o que foi falado
                                                        durante a consulta n√£o ir√° sair de l√°.</strong></div>
                                            </div>
                                        </div>
                                        <div class="card feature" id="contatos">
                                            <div class="card5">
                                                <div class="icon">üìû</div>
                                                <h2>Contatos</h2>
                                                <div class="texto-card5"><strong>E-mail:
                                                        kaciely123@gmail.com<br>N√∫mero: +55 (48) 99999-9999</strong>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <section id="sobre-mim">
                                    <div class="sobre-mim">
                                        <br><br><br><br><br><br><br>
                                        <div class="titulo-c feature">
                                            <h1>Sobre Mim</h1>
                                        </div>
                                        <br><br><br><br><br>
                                        <div class="text feature">
                                            <strong style="font-size: 18px;">
                                                <p>sobre mim: me chamo Kaciely, sou psic√≥loga cl√≠nica h√° mais de 2 anos,
                                                    atendendo demandas como:<br><br><br>
                                                    ansiedade, depress√£o, ins√¥nia, procrastina√ß√£o, TDAH, transtornos
                                                    alimentares, ansiedade social,<br><br><br>
                                                    baixa autoestima, conflitos nas rela√ß√µes e diversas outras demandas.
                                                    Al√©m disso,<br><br><br>
                                                    atendo em orienta√ß√£o de pais h√° mais de 2 anos. Atendo pais de
                                                    adolescentes que est√£o tendo dificuldade com<br><br><br>
                                                    comportamentos t√≠picos da adolesc√™ncia, como: uso excessivo de
                                                    telas, mentiras, namoro e sexualidade,<br><br><br>
                                                    amizades e suas influ√™ncias, dificuldades escolares, falta de
                                                    coopera√ß√£o nas tarefas de casa ou quaisquer<br><br><br>
                                                    dificuldades que a fam√≠lia possa enfrentar. Durante a faculdade, no
                                                    est√°gio cl√≠nico, atendi adolescentes e<br><br><br>
                                                    percebi que seus maiores sofrimentos estavam relacionados aos
                                                    relacionamentos familiares, por isso atuo nessa √°rea desde ent√£o.
                                                </p>
                                            </strong>
                                        </div>
                                </section>

                                <img src="img/kaci.png" alt="" class="kaci feature"
                                    style="width: 40vh; box-shadow: 0px 0px 0px rgba(0, 0, 0, 0);">

                                <br><br><br><br><br><br><br>


                                <section id="oqe"></section>
                                <div class="titulo-c feature">
                                    <h1>O que √© orienta√ß√£o de pais?</h1>
                                </div>
                                <br><br><br><br>
                                <div class="text feature">
                                    <strong style="font-size: 18px;">
                                        <p>A orienta√ß√£o de pais √© um servi√ßo, oferecido por psic√≥logos, que pode te
                                            ajudar a lidar com comportamentos</p><br>
                                        <p>desafiadores de seu filho (seja crian√ßa ou adolescente), como: birras,
                                            mentiras, uso excessivo de telas,</p><br>
                                        <p> ‚Äúdesobedi√™ncia‚Äù (te ajuda refletir sobre o termo e sobre controle), emo√ß√µes
                                            desreguladas, dificuldade em</p><br>
                                        <p>lidar com frustra√ß√µes, agressividade, separa√ß√£o dos pais ou ainda se voc√™ tem
                                            se sentido insatisfeito/a com sua</p><br>
                                        <p>forma de educar e tem desejado uma educa√ß√£o respeitosa e se conectar com seu
                                            filho.</p><br>
                                        <p>diversos contextos, desde cl√≠nicas de reabilita√ß√£o</p><br>
                                        <p>Cada profissional ter√° uma abordagem, mas geralmente s√£o sess√µes com os
                                            pais/cuidadores da crian√ßa ou do</p><br>
                                        <p>adolescente, com professores ou bab√°s, essas sess√µes podem ocorrem
                                            semanalmente ou quinzenalmente.</p><br>
                                        <p>O n√∫mero de sess√µes depender√° da demanda e dedica√ß√£o da fam√≠lia.</p><br>
                                        <p>O psic√≥logo buscar√°, junto com a fam√≠lia, as estrat√©gias que melhor se
                                            encaixam em sua realidade. </p><br>
                                        <p>Essas sess√µes devem ser um espa√ßo livre de julgamentos e cr√≠ticas.</p><br>
                                    </strong>
                                </div>
                                </section>

                                <img src="img/orientacao.png" alt=""
                                    style="width: 500px; border-radius: 10vh; box-shadow: 0px 0px 0px rgba(0, 0, 0, 0); margin-top: -600px;"
                                    class="orientacao feature">

                                <br><br><br><br><br><br><br>

                                <section id="vantagens">
                                    <div class="titulo-c feature">
                                        <h1>Vantagens de marcar uma consulta</h1>
                                    </div>
                                    <br><br><br>
                                    <div class="text-v feature">
                                        <strong style="font-size: 18px;">
                                            <p>. Autoconhecimento: Acompanhamento psicol√≥gico ajuda a entender melhor
                                                seus pensamentos, sentimentos e comportamentos, promovendo uma maior
                                                compreens√£o de si mesmo.</p>
                                            <br>
                                            <p>. Gerenciamento de Estresse: T√©cnicas e estrat√©gias aprendidas em sess√µes
                                                podem ajudar a lidar com o estresse e a ansiedade de forma mais eficaz.
                                            </p>
                                            <br>
                                            <p>. Resolu√ß√£o de Conflitos: A terapia pode auxiliar na resolu√ß√£o de
                                                conflitos pessoais e interpessoais, melhorando relacionamentos e
                                                comunica√ß√£o.</p>
                                            <br>
                                            <p>. Melhoria da Sa√∫de Mental: Profissionais podem identificar e tratar
                                                quest√µes como depress√£o, transtornos de ansiedade e outros problemas de
                                                sa√∫de mental.</p>
                                            <br>
                                            <p>. Desenvolvimento de Habilidades: Psic√≥logos ajudam a desenvolver
                                                habilidades de enfrentamento e estrat√©gias para lidar com desafios e
                                                adversidades.</p>
                                            <br>
                                            <p>. Apoio em Mudan√ßas: Acompanhamento psicol√≥gico pode ser um suporte
                                                valioso durante per√≠odos de transi√ß√£o ou mudan√ßa significativa na vida.
                                            </p>
                                            <br>
                                            <p>. Objetividade e Confidencialidade: A terapia oferece um espa√ßo seguro e
                                                imparcial para explorar e discutir quest√µes pessoais sem julgamento.</p>
                                            <br>
                                            <p>. Promo√ß√£o do Bem-Estar: Ao trabalhar com um psic√≥logo, voc√™ pode
                                                melhorar seu bem-estar geral e qualidade de vida, encontrando um
                                                equil√≠brio saud√°vel entre seus diversos pap√©is e responsabilidades.</p>
                                            <br>
                                            <p>. Essas s√£o apenas algumas das vantagens que podem tornar a experi√™ncia
                                                com um psic√≥logo bastante ben√©fica e enriquecedora.</p>
                                        </strong>
                                </section>
                            </div>
                        </div>
                        <div class="area-2">
                            <img src="img/sobre-mim.jpg" alt="Sobre Mim">
                        </div>
                    </div>

                    <section id="agenda">
                        <div class="titulo-c feature">
                            <h1>Agenda</h1>
                        </div>
                        <br><br>
                        <div class="calendar-container feature">
                            <div class="month-header">
                                <button onclick="previousMonth()">&lt;</button>
                                <h2 id="monthDisplay"></h2>
                                <button onclick="nextMonth()">&gt;</button>
                            </div>
                            <div class="weekdays">
                                <div>Dom</div>
                                <div>Seg</div>
                                <div>Ter</div>
                                <div>Qua</div>
                                <div>Qui</div>
                                <div>Sex</div>
                                <div>S√°b</div>
                            </div>
                            <div class="days" id="daysContainer"></div>
                        </div>
                        <form class="tela-blur" name="tela-blur-agend" id="tela-blur-agend" action="/agendar-consulta"
                            method="post">
                            <input type="hidden" name="id_cliente" id="id_cliente" value="<%= cliente.id_cliente %>">
                            <div class="cards card tela-senha" style="height: 50vh;" name="tela-agend" id="tela-agend">
                                <h1>Agendar consulta</h1>
                                <br>
                                <input type="hidden" name="data" id="data">
                                Hor√°rio desejado:
                                <select name="horarios" id="horarios" style="width: 180px;">
                                    <option value="">Selecione um hor√°rio</option>
                                    <% const horariosDisponiveis=[ '09:00:00' , '10:00:00' , '11:00:00' , '12:00:00'
                                        , '13:00:00' , '14:00:00' , '15:00:00' , '16:00:00' , '17:00:00' ]; const
                                        horariosOcupados=consultas.map(consul=> consul.horario_consulta);
                                        %>
                                        <% horariosDisponiveis.forEach(horario=> { %>
                                            <% if (horariosOcupados.includes(horario)) { %>
                                                <option value="<%= horario %>" disabled>
                                                    <%= horario.slice(0, 5) %>
                                                </option>
                                                <% } else { %>
                                                    <option value="<%= horario %>">
                                                        <%= horario.slice(0, 5) %>
                                                    </option>
                                                    <% } %>
                                                        <% }) %>
                                </select>
                                <br>
                                Descri√ß√£o: <textarea rows="5" cols="30"
                                    placeholder="Digite uma descri√ß√£o para a consulta(opcional)" name="descricao"
                                    id="descricao"></textarea>
                                <br>
                                <div>
                                    <a class="btn button cancelar-senha" style="background-color: #EE0000;"
                                        onclick="cancelarAgendamento()">Cancelar</a>
                                    <button class="btn button confirmar-senha"
                                        style="background-color: #FF9900;">Confirmar</button>
                                </div>
                            </div>
                        </form>
                        <br><br>
                            <% let quantConsultas = 0 %>
                            <% let quantConsultasConcluidas = 0 %>
                            <% if (locals.session && locals.session.usuario && locals.session.usuario.permissao===false){ %>
                                <div class="titulo-c feature">
                                    <h1>Suas consultas</h1>
                                </div>
                                <% if (consultasCliente !=undefined){ %>
                                    <div class="cards-agenda">
                                        <% consultasCliente.forEach((consulCliente)=>{ %>
                                            <% quantConsultas++ %>
                                            <% if(consulCliente.status == 'Realizado') {
                                                quantConsultasConcluidas++;
                                            } %>
                                                <form class="container-principal" method="post"
                                                    action="/cancelar-agendamento">
                                                    <div class="container-consulta feature">
                                                        <div class="consulta-topo">
                                                            <h2 class="consulta-numero"><%- session.usuario.nome %> #<%-
                                                                        quantConsultas %></h2>
                                                            <% if (consulCliente.status=='Ativo' ) { %>
                                                                <span class="consulta-status"><%- consulCliente.status
                                                                        %></span>
                                                                <% } else if (consulCliente.status=='Cancelado' ) { %>
                                                                    <span class="consulta-status"
                                                                        style="background-color: #EE0000;"><%-
                                                                            consulCliente.status %></span>
                                                                    <% } else { %>
                                                                        <span class="consulta-status"
                                                                            style="background-color: #FF9900;"><%-
                                                                                consulCliente.status %></span>
                                                                        <% } %>
                                                        </div>

                                                        <div class="consulta-linha">
                                                            <span class="consulta-rotulo">Data:</span>
                                                            <span class="consulta-dado"><%- consulCliente.data_consulta
                                                                    %></span>
                                                            <input type="hidden" name="data_agendament"
                                                                id="data_agendament<%= quantConsultas %>"
                                                                value="<%= consulCliente.data_consulta %>">
                                                        </div>

                                                        <div class="consulta-linha">
                                                            <span class="consulta-rotulo">Hor√°rio:</span>
                                                            <span class="consulta-dado"><%-
                                                                    consulCliente.horario_consulta %></span>
                                                            <input type="hidden" name="hora_agendament"
                                                                id="hora_agendament<%= quantConsultas %>"
                                                                value="<%= consulCliente.horario_consulta %>">
                                                        </div>

                                                        <div class="consulta-desc">
                                                            <div class="consulta-desc-rotulo">Descri√ß√£o:</div>
                                                            <p class="consulta-desc-texto">
                                                                <%- consulCliente.descricao || "Sem descri√ß√£o" %>
                                                            </p>
                                                        </div>
                                                        <% const data_consulta=new Date(consulCliente.data_consulta);
                                                            const data_atual_date=new Date(data_atual); %>
                                                            <% if (consulCliente.status=='Ativo' && data_consulta>=
                                                                data_atual_date) { %>
                                                                <div align="center">
                                                                    <a class="btn button sair-btn"
                                                                        style="background-color: #DD0000;"
                                                                        onclick="abrirConfirma√ß√£o('<%= quantConsultas %>')">Cancelar</a>
                                                                </div>
                                                                <% } else { %>
                                                                    <div class="consulta-footer"></div>
                                                                    <% } %>
                                                    </div>
                                                    <div class="tela-blur" name="tela-blur-senha"
                                                        id="tela-blur-senha<%= quantConsultas %>">
                                                        <div class="cards card tela-senha" style="height: 420px;"
                                                            name="tela-senha" id="tela-senha<%= quantConsultas %>">
                                                            <h1>Confirmar senha</h1>
                                                            <br><br>
                                                            Senha: <input type="password" name="senha"
                                                                id="senha<%= quantConsultas %>">
                                                            <br><br>
                                                            Confirmar senha: <input type="password" name="confirmar"
                                                                id="confirmar<%= quantConsultas %>">
                                                            <br>
                                                            <div id="mensagem-erro<%= quantConsultas %>"
                                                                style="display:none;"></div>
                                                            <br>
                                                            <div>
                                                                <a class="btn button cancelar-senha"
                                                                    style="background-color: #EE0000;"
                                                                    onclick="voltarConfirmacao('<%= quantConsultas %>')">Voltar</a>
                                                                <button class="btn button confirmar-senha"
                                                                    style="background-color: #FF9900;"
                                                                    onclick="confirmarSenha('mensagem-erro<%= quantConsultas %>', 'senha<%= quantConsultas %>', 'confirmar<%= quantConsultas %>')">Confirmar</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </form>
                                                <% }) %>
                                    </div>
                                    <% } %>
                                        <% } %>
                    </section>

                    <section id="comentarios">
                        <div class="titulo-c feature">
                            <h1>Feedbacks</h1>
                            <br><br>
                            <% if (!(locals.session && locals.session.usuario &&
                                locals.session.usuario.permissao===true)) { %>
                                    <% if(quantConsultasConcluidas > 0) { %>
                                <form action="/comentar" method="POST" class="comment-form">
                                    <div class="comment-header">
                                        <img class="avatar" src="img/<%= imagemUsuarioAtual.imagem %>"
                                            alt="Sua foto de perfil">
                                        <input type="hidden" name="nome_cliente" id="nome_cliente"
                                            value="<%= session.usuario && session.usuario.nome ? session.usuario.nome : '' %>">
                                    </div>
                                    <textarea name="comentario" id="comentario" placeholder="O que achou da consulta?"
                                        required></textarea>
                                    <button type="submit">Enviar</button>
                                </form>
                                <% } %>
                                <% } %>

                                    <div class="order-controls">
                                        <a href="/?order=recent"
                                            class="order-button <%= orderType === 'recent' ? 'active' : '' %>">
                                            Mais Recentes
                                        </a>
                                        <a href="/?order=upvotes"
                                            class="order-button <%= orderType === 'upvotes' ? 'active' : '' %>">
                                            Mais Votados
                                        </a>
                                    </div>

                                    <div class="comentarios">
                                        <% comentarios.forEach(function(comentario) { %>
                                            <div class="comentario">
                                                <div class="comentario-header">
                                                    <div class="usuario-info">
                                                        <img class="avatar" src="img/<%= comentario.imagemPerfil %>"
                                                            alt="Foto de perfil">
                                                        <strong class="autor">
                                                            <%= comentario.autor %>
                                                        </strong>
                                                    </div>
                                                    <small class="data">
                                                        <%= new Date(comentario.createdAt).toLocaleDateString() %>
                                                    </small>
                                                </div>
                                                <p class="comentario-texto">
                                                    <%= comentario.comentario %>
                                                </p>

                                                <% if (cliente && cliente.id_cliente && !(locals.session &&
                                                    locals.session.usuario && locals.session.usuario.permissao===true) && quantConsultasConcluidas > 0)
                                                    { %>
                                                    <div class="votes">
                                                        <% const userVote=avaliacoesCliente.find(av=>
                                                            av.id_comentario === comentario.id_comentario
                                                            )?.tipoVoto || null;
                                                            %>
                                                            <button
                                                                onclick="votar('<%= comentario.id_comentario %>', 'upvote')"
                                                                class="vote-button <%= userVote === 'upvote' ? 'active upvote' : '' %>"
                                                                <%=!cliente ? 'disabled' : '' %>
                                                                >
                                                                üëç <span id="upvotes-<%= comentario.id_comentario %>">
                                                                    <%= comentario.upvotes %>
                                                                </span>
                                                            </button>
                                                            <span class="score"
                                                                id="score-<%= comentario.id_comentario %>">
                                                                <%= comentario.upvotes - comentario.downvotes %>
                                                            </span>
                                                            <button
                                                                onclick="votar('<%= comentario.id_comentario %>', 'downvote')"
                                                                class="vote-button <%= userVote === 'downvote' ? 'active downvote' : '' %>"
                                                                <%=!cliente ? 'disabled' : '' %>
                                                                >
                                                                üëé <span id="downvotes-<%= comentario.id_comentario %>">
                                                                    <%= comentario.downvotes %>
                                                                </span>
                                                            </button>
                                                    </div>
                                                    <% } %>
                                            </div>
                                            <% }); %>
                                    </div>
                                    <br><br><br>
                        </div>
                    </section>

                    <script>
                        document.addEventListener("DOMContentLoaded", () => {
                            const features = document.querySelectorAll(".feature");

                            const checkScroll = () => {
                                const triggerBottom = (window.innerHeight / 5) * 4;

                                features.forEach((feature, index) => {
                                    const featureTop = feature.getBoundingClientRect().top;

                                    if (featureTop < triggerBottom) {
                                        feature.classList.add("show");
                                    } else {
                                        feature.classList.remove("show");
                                    }
                                });
                            };

                            checkScroll();

                            let timeout;
                            window.addEventListener("scroll", () => {
                                if (timeout) {
                                    window.cancelAnimationFrame(timeout);
                                }

                                timeout = window.requestAnimationFrame(() => {
                                    checkScroll();
                                });
                            });

                            updateCalendar();
                        });
                        let currentDate = new Date();
                        let selectedDate = null;
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);

                        const waitingPeriodEnd = new Date(today);
                        waitingPeriodEnd.setDate(today.getDate() + 6);

                        function updateCalendar() {
                            const year = currentDate.getFullYear();
                            const month = currentDate.getMonth();

                            const firstDay = new Date(year, month, 1);
                            const lastDay = new Date(year, month + 1, 0);

                            const monthDisplay = document.getElementById('monthDisplay');
                            const daysContainer = document.getElementById('daysContainer');

                            const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho',
                                'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                            monthDisplay.textContent = `${monthNames[month]} ${year}`;

                            daysContainer.innerHTML = '';

                            const firstDayIndex = firstDay.getDay();
                            for (let i = firstDayIndex - 1; i >= 0; i--) {
                                const prevDate = new Date(year, month, -i);
                                const dayDiv = createDayElement(prevDate, true);
                                daysContainer.appendChild(dayDiv);
                            }

                            for (let day = 1; day <= lastDay.getDate(); day++) {
                                const date = new Date(year, month, day);
                                const dayDiv = createDayElement(date, false);
                                daysContainer.appendChild(dayDiv);
                            }

                            const lastDayIndex = lastDay.getDay();
                            for (let i = 1; i < 7 - lastDayIndex; i++) {
                                const nextDate = new Date(year, month + 1, i);
                                const dayDiv = createDayElement(nextDate, true);
                                daysContainer.appendChild(dayDiv);
                            }
                        }

                        function createDayElement(date, isOtherMonth) {
                            const dayDiv = document.createElement('div');
                            dayDiv.className = 'day';
                            dayDiv.textContent = date.getDate();

                            const compareDate = new Date(date);
                            compareDate.setHours(0, 0, 0, 0);

                            if (compareDate <= waitingPeriodEnd && compareDate >= today) {
                                dayDiv.classList.add('waiting-period');
                                dayDiv.title = 'Deve ser agendado com no m√≠nimo uma semana de anteced√™ncia!';
                            } else if (compareDate < today) {
                                dayDiv.classList.add('disabled');
                            }

                            if (isOtherMonth) {
                                dayDiv.classList.add('other-month');
                            }

                            if (compareDate.getTime() === today.getTime()) {
                                dayDiv.classList.add('today');
                            }

                            if (selectedDate && compareDate.getTime() === selectedDate.getTime()) {
                                dayDiv.classList.add('selected');
                            }

                            dayDiv.addEventListener('click', () => {
                                if (dayDiv.classList.contains('disabled') || dayDiv.classList.contains('waiting-period')) {
                                    return;
                                }

                                if (selectedDate) {
                                    document.querySelector('.day.selected')?.classList.remove('selected');
                                }
                                selectedDate = new Date(date);
                                dayDiv.classList.add('selected');

                                var data_agend = date.toLocaleDateString('sv-SE');

                                buscarHorarios(data_agend);
                                abrirAgendamento(data_agend)
                            });

                            return dayDiv;
                        }

                        function previousMonth() {
                            currentDate.setMonth(currentDate.getMonth() - 1);
                            updateCalendar();
                        }

                        function nextMonth() {
                            currentDate.setMonth(currentDate.getMonth() + 1);
                            updateCalendar();
                        }

                        function abrirAgendamento(data_agend) {
                            let tela_agend = document.getElementById('tela-agend');
                            let tela_blur_agend = document.getElementById('tela-blur-agend');
                            let data_agendamento = document.getElementById('data');

                            tela_agend.classList.add('mostrar');
                            tela_blur_agend.classList.add('mostrar');
                            body.classList.add('travar');
                            data_agendamento.value = data_agend;
                        }

                        function cancelarAgendamento() {
                            let tela_agend = document.getElementById('tela-agend');
                            let tela_blur_agend = document.getElementById('tela-blur-agend');
                            let horarios = document.getElementById('horarios');
                            let descricao = document.getElementById('descricao');

                            horarios.value = "";
                            descricao.value = "";

                            tela_agend.classList.remove('mostrar');
                            tela_blur_agend.classList.remove('mostrar');
                            body.classList.remove('travar');
                        }

                        function abrirConfirma√ß√£o(idConsult) {
                            let tela_senha = document.getElementById(`tela-senha${idConsult}`);
                            let tela_blur_senha = document.getElementById(`tela-blur-senha${idConsult}`);

                            tela_senha.classList.add('mostrar');
                            tela_blur_senha.classList.add('mostrar');
                            body.classList.add('travar');
                        }

                        function voltarConfirmacao(idConsult) {
                            let tela_senha = document.getElementById(`tela-senha${idConsult}`);
                            let tela_blur_senha = document.getElementById(`tela-blur-senha${idConsult}`);
                            let senha = document.getElementById(`senha${idConsult}`);
                            let confirmar = document.getElementById(`confirmar${idConsult}`);
                            let mensagem_erro = document.getElementById(`mensagem-erro${idConsult}`);

                            senha.value = "";
                            confirmar.value = "";
                            mensagem_erro.innerHTML = "";
                            mensagem_erro.style.display = 'none';

                            tela_senha.classList.remove('mostrar');
                            tela_blur_senha.classList.remove('mostrar');
                            body.classList.remove('travar');
                        }

                        function confirmarSenha(idMensagem_erro, idSenha, idConfirmar) {
                            let senha = document.getElementById(idSenha).value;
                            let confirmar = document.getElementById(idConfirmar).value;
                            let mensagem_erro = document.getElementById(idMensagem_erro);

                            if (senha != confirmar) {
                                mensagem_erro.innerHTML = "<p style='color:red'>As senhas n√£o conferem!</p>";
                                mensagem_erro.style.display = 'block';
                                event.preventDefault();
                            } else if (senha == "" || confirmar == "") {
                                mensagem_erro.innerHTML = "<p style='color:red'>Os campos n√£o podem ficar vazios!</p>";
                                mensagem_erro.style.display = 'block';
                                event.preventDefault();

                            } else {
                                mensagem_erro.style.display = 'none';
                            }
                        }

                        async function buscarHorarios(valueData_agend) {
                            const data_agend = valueData_agend;

                            try {
                                const response = await axios.get(`/api/get-data/${data_agend}`);
                                console.log("Hor√°rios recebidos:", response);

                                const horariosOcupados = response.data.map(consul => consul.horario_consulta);

                                atualizarHorariosDisponiveis(horariosOcupados);
                            } catch (error) {
                                console.error('Erro ao buscar os hor√°rios:', error);
                            }
                        }

                        function atualizarHorariosDisponiveis(horariosOcupados) {
                            const selectElement = document.getElementById('horarios');
                            const options = selectElement.querySelectorAll('option');

                            options.forEach(option => {
                                if (horariosOcupados.includes(option.value)) {
                                    option.disabled = true;
                                } else {
                                    option.disabled = false;
                                }
                            });
                        }

                        async function votar(commentId, tipoVoto) {
                            try {
                                const response = await fetch('/votar', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify({
                                        id_comentario: commentId,
                                        tipoVoto: tipoVoto
                                    })
                                });

                                const data = await response.json();
                                if (data.success) {
                                    // Atualizar contadores
                                    document.getElementById(`upvotes-${commentId}`).textContent = data.upvotes;
                                    document.getElementById(`downvotes-${commentId}`).textContent = data.downvotes;
                                    document.getElementById(`score-${commentId}`).textContent = data.score;

                                    // Pegar os bot√µes
                                    const upvoteButton = document.querySelector(`button[onclick="votar('${commentId}', 'upvote')"]`);
                                    const downvoteButton = document.querySelector(`button[onclick="votar('${commentId}', 'downvote')"]`);

                                    // Remover classes ativas anteriores
                                    upvoteButton.classList.remove('active', 'upvote');
                                    downvoteButton.classList.remove('active', 'downvote');

                                    // Adicionar classe ativa ao bot√£o clicado
                                    if (tipoVoto === 'upvote') {
                                        upvoteButton.classList.add('active', 'upvote');
                                    } else if (tipoVoto === 'downvote') {
                                        downvoteButton.classList.add('active', 'downvote');
                                    }

                                    const urlParams = new URLSearchParams(window.location.search);
                                    if (urlParams.get('order') === 'upvotes') {
                                        window.location.reload();
                                    }
                                } else {
                                    alert(data.error || 'Erro ao processar voto');
                                }
                            } catch (error) {
                                console.error('Erro ao votar:', error);
                                alert('Erro ao processar voto');
                            }
                        }

                    </script>
                    <%- include("partials/footer.ejs") %>
